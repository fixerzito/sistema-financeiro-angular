<form class="main" [formGroup]="formGroup">
    <div class="form-container">
        <div class="input-group">
            <label for="username" class="form-label"> Nome da Transação <span class="warning-text">*</span></label>
            <p-autoComplete id="username" class="w-10rem" autocomplete="off" formControlName="nome"
                (onSelect)="abrirModal()" [suggestions]="filteredTransacoesDropdown"
                (completeMethod)="filtrarTransacoes($event)" [showClear]="true" showEmptyMessage="false"> 
                <ng-template let-transacao pTemplate="item">
                    <div class="flex flex-row">
                        <h4 class="mr-2">{{ transacao.nome }}</h4>
                        <div>
                            <p>R$ {{ transacao.valor }}</p>
                            <p>{{ transacao.categoria }}</p>
                        </div>
                    </div>
                </ng-template>
            </p-autoComplete>

            <span class="warning-text">
                {{ errorMessages!.nome }}
            </span>
        </div>

        <div class="radio-group">
            <label for="validContaBancaria" class="form-label">Selecione a conta que deseja vincular <span
                    class="warning-text">*</span></label>
            <p-dropdown [options]="contasDropdown" formControlName="idContaBancaria" optionLabel="name"
                (onShow)="carregarContasBancarias()" optionValue="id" placeholder="Escolha a conta a ser vinculada"
                (onChange)="atribuirIdConta(transacao.idContaBancaria!)">
                <ng-template let-cartao pTemplate="item">
                    {{cartao.nome}}
                </ng-template>
                <ng-template let-cartao pTemplate="selectedItem">
                    {{cartao.nome}}
                </ng-template>
            </p-dropdown>
            <span class="warning-text">
                {{ errorMessages!.idContaBancaria }}
            </span>
        </div>

        <div class="input-group flex flex-row">
            <div class="flex flex-column">
                <label class="form-label">Categoria <span class="warning-text">*</span></label>
                <p-dropdown [options]="categorias" optionLabel="name" optionValue="id" (onShow)="carregarCategorias()"
                    placeholder="Escolha a categoria à ser vinculada" (onChange)="onCategoriaChange($event)"
                    formControlName="idCategoriaTransacao">
                    <ng-template let-categoria pTemplate="item">
                        {{categoria.nome}}
                    </ng-template>
                    <ng-template let-categoria pTemplate="selectedItem">
                        {{categoria.nome}}
                    </ng-template>
                </p-dropdown>
                <span class="warning-text">
                    {{ errorMessages!.idCategoriaTransacao }}
                </span>
            </div>
            <div class="flex flex-column">
                <label class="form-label">Subcategoria <span class="warning-text">*</span></label>
                <p-dropdown [options]="subcategorias" optionLabel="name" optionValue="id"
                    [loading]="carregandoSubcategoriasDropdown" placeholder="Escolha a categoria à ser vinculada"
                    [disabled]="formGroup.get('idSubcategoriaTransacao')!.disabled"
                    formControlName="idSubcategoriaTransacao">
                    <ng-template let-categoria pTemplate="item">
                        {{categoria.nome}}
                    </ng-template>
                    <ng-template let-categoria pTemplate="selectedItem">
                        {{categoria.nome}}
                    </ng-template>
                </p-dropdown>
                <span class="warning-text">
                    {{ errorMessages!.idSubcategoriaTransacao }}
                </span>
            </div>
        </div>

        <div class="flex flex-row">
            <div class="flex flex-column">
                <label for="dataPrevista" class="form-label">Data prevista</label>
                <p-calendar formControlName="dataPrevista" [iconDisplay]="'input'" [showIcon]="true"
                    inputId="dataPrevista">
                </p-calendar>
            </div>

            <div class="flex flex-column">
                <label for="dataEfetivacao" class="form-label">Data efetivação</label>
                <p-calendar formControlName="dataEfetivacao" [iconDisplay]="'input'" [showIcon]="true"
                    inputId="dataEfetivacao">
                </p-calendar>
            </div>
        </div>

        <label class="form-label">Status da transação</label>
        <div class="radio-options">
            <p-radioButton [value]="false" formControlName="status" inputId="pendente" />
            <label for="pendente" class="ml-2">
                Pendente
            </label>

            <p-radioButton [value]="true" formControlName="status" inputId="efetuada" />
            <label for="efetuada" class="ml-2">
                Efetuada
            </label>
        </div>

        <label for="validContaBancaria" class="form-label">Tipo de Transação</label>
        <div class="radio-options">
            <p-radioButton [value]="true" formControlName="tipoTransacao" inputId="entrada" class="radio-btn" />
            <label for="entrada" class="radio-label">Entrada</label>

            <p-radioButton [value]="false" formControlName="tipoTransacao" inputId="saida" class="radio-btn" />
            <label for="saida" class="radio-label">Saída</label>
        </div>

        <div class="input-group">
            <label for="valorTransacao" class="form-label">Valor da Transação <span
                    class="warning-text">*</span></label>
            <p-inputNumber mode="decimal" inputId="valorTransacao" autocomplete="off" placeholder="R$" locale="pt-BR"
                formControlName="valor" (onKeyDown)="filterNotNumberKeys($event)" [minFractionDigits]="2"
                [maxFractionDigits]="2" />
            <span class="warning-text">
                {{ errorMessages!.valor }}
            </span>

            <div class="button-group">
                <p-button label="Cancelar" (onClick)="cancelar()" severity="secondary" [outlined]="true"
                    icon="pi pi-undo" class="button cancel" />
                <p-button label="Salvar" (onClick)="salvar()" icon="pi pi-save" class="button save" />
            </div>
        </div>
    </div>
</form>

<form [formGroup]="formTransacaoClone">
    <p-dialog header="Manter dados" [modal]="true" [(visible)]="visible" [style]="{ width: '25rem' }">
        <!-- <span class="p-text-secondary block mb-5">Escolha os dados que deseja manter da transação selecionada</span> -->
        <div class="flex align-items-center gap-3 mb-3">
            <p-checkbox formControlName="nome" [value]="transacaoClone!.nome" inputId="nome" />
            <label for="nome">Nome</label>
        </div>
        <div class="flex align-items-center gap-3 mb-3">
            <p-checkbox formControlName="valor" [value]="transacaoClone!.valor" inputId="valor" />
            <label for="valor">Valor</label>
        </div>
        <div class="flex align-items-center gap-3 mb-3">
            <p-checkbox formControlName="catSubcat" [value]="transacaoClone!.idCategoriaTransacao" inputId="catSubcat" />
            <label for="catSubcat">Categoria e subcategoria</label>
        </div>
        <div class="flex align-items-center gap-3 mb-3">
            <p-checkbox formControlName="contaBancaria" [value]="transacaoClone!.idContaBancaria" inputId="contaBancaria" />
            <label for="contaBancaria">Conta</label>
        </div>

        <div class="flex justify-content-end gap-2">
            <p-button label="Cancel" severity="secondary" (onClick)="resetarCamposFormulario()" />
            <p-button label="Save" (onClick)="salvarModal()" />
        </div>
    </p-dialog>
</form>